############################################
# BASIC SETUP
############################################
Options -MultiViews
RewriteEngine On

############################################
# 0. REMOVE DOUBLE SLASHES (IMPORTANT)
############################################
RewriteCond %{THE_REQUEST} //
RewriteRule .* /$0 [R=301,L]

############################################
# 1. FIX DUPLICATE CONTENT (Force non-WWW)
############################################
RewriteCond %{HTTP_HOST} ^www\.(.+)$ [NC]
RewriteRule ^ https://%1%{REQUEST_URI} [R=301,L]

############################################
# 2. FORCE HTTPS
############################################
RewriteCond %{HTTPS} off
RewriteRule ^ https://%{HTTP_HOST}%{REQUEST_URI} [R=301,L]

############################################
# 3. HIDE .html EXTENSION
############################################
# Redirect /page.html â†’ /page
RewriteCond %{THE_REQUEST} \s/+(.+?)\.html [NC]
RewriteRule ^ %1 [R=301,L]

# Serve page.html internally for /page
RewriteCond %{REQUEST_FILENAME} !-d
RewriteCond %{REQUEST_FILENAME}.html -f
RewriteRule ^(.+)$ $1.html [L]

############################################
# SECURITY HEADERS
############################################
<IfModule mod_headers.c>
  Header always set Strict-Transport-Security "max-age=63072000; includeSubDomains; preload"
  Header always set X-Frame-Options "SAMEORIGIN"
  Header always set X-Content-Type-Options "nosniff"
  Header always set Referrer-Policy "strict-origin-when-cross-origin"
  Header always set Permissions-Policy "geolocation=(), camera=(), microphone=()"
  Header always set Content-Security-Policy "default-src 'self' https:; script-src 'self' https://www.gstatic.com https://www.googletagmanager.com https://www.google-analytics.com 'unsafe-inline'; style-src 'self' https: 'unsafe-inline'; img-src 'self' https: data:; font-src 'self' https: data:; connect-src 'self' https://www.google-analytics.com https://firebase.googleapis.com https://firestore.googleapis.com; frame-ancestors 'self';"
</IfModule>

ServerSignature Off
ServerTokens Prod
